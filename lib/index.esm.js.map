{"version":3,"file":"index.esm.js","sources":["../src/types/index.ts","../src/constants/index.ts","../src/components/UserAssignment.tsx","../src/hooks/useWorkflowMetadata.tsx","../src/components/WorkflowContext.tsx","../src/actions/AssignWorkflow.tsx","../src/actions/BeginWorkflow.tsx","../src/actions/CompleteWorkflow.tsx","../src/helpers/arraysContainMatchingString.ts","../src/actions/UpdateWorkflow.tsx","../src/badges/AssigneesBadge.tsx","../src/badges/StateBadge.tsx","../src/components/WorkflowSignal.tsx","../src/components/DocumentCard/EditButton.tsx","../src/components/DocumentCard/Field.tsx","../src/components/UserAssignmentInput.tsx","../src/helpers/initialRank.ts","../src/schema/workflow/workflow.metadata.ts","../src/helpers/filterItemsAndSort.ts","../src/hooks/useWorkflowDocuments.tsx","../src/components/DocumentCard/AvatarGroup.tsx","../src/components/UserDisplay.tsx","../src/components/DocumentCard/CompleteButton.tsx","../src/components/DocumentCard/core/TimeAgo.tsx","../src/components/DocumentCard/core/DraftStatus.tsx","../src/components/DocumentCard/core/PublishedStatus.tsx","../src/components/DocumentCard/Validate.tsx","../src/components/DocumentCard/ValidationStatus.tsx","../src/components/DocumentCard/index.tsx","../src/components/DocumentList.tsx","../src/components/Filters.tsx","../src/components/StateTitle/Status.tsx","../src/components/StateTitle/index.tsx","../src/helpers/generateMultipleOrderRanks.ts","../src/components/FloatingCard.tsx","../src/components/Verify.tsx","../src/components/WorkflowTool.tsx","../src/tools/index.ts","../src/index.ts"],"sourcesContent":["import {CurrentUser, SanityDocumentLike} from 'sanity'\n\nexport type State = {\n  id: string\n  transitions: string[]\n  title: string\n  roles?: string[]\n  requireAssignment?: boolean\n  requireValidation?: boolean\n  // From document badges\n  color?: 'primary' | 'success' | 'warning' | 'danger'\n}\n\nexport type StateCheck<Id, States> = {\n  id: Id\n  // Transitions is an array of State ids\n  transitions?: States extends {id: infer Id2}[] ? Id2[] : never\n} & State\n\nexport type WorkflowConfig = {\n  schemaTypes: string[]\n  states?: State[]\n  filters?: (user: CurrentUser | null) => string\n}\n\nexport function defineStates<\n  Id extends string,\n  States extends StateCheck<Id, States>[]\n>(states: States): States {\n  return states\n}\n\nexport type User = {\n  createdAt: string\n  displayName: string\n  email: string\n  familyName: string\n  givenName: string\n  id: string\n  imageUrl: string\n  isCurrentUser: boolean\n  middleName: string\n  projectId: string\n  provider: string\n  sanityUserId: string\n  updatedAt: string\n}\n\nexport type DragData = {\n  documentId?: string\n  x?: number\n  y?: number\n  state?: string\n}\n\nexport type Metadata = SanityDocumentLike & {\n  _rev: string\n  assignees: string[]\n  documentId: string\n  state: string\n  orderRank: string\n  locale: string\n}\n\nexport type KeyedMetadata = {[key: string]: Metadata}\n\nexport type SanityDocumentWithMetadata = {\n  _metadata: Metadata\n  _id: string\n  _type: string\n  _rev: string\n  _updatedAt: string\n}\n","import {defineStates, WorkflowConfig} from '../types'\n\nexport const API_VERSION = `2023-01-01`\n\nexport const DEFAULT_CONFIG: Required<WorkflowConfig> = {\n  schemaTypes: [],\n  states: defineStates([\n    {\n      id: 'inReview',\n      title: 'In review',\n      color: 'primary',\n      roles: ['editor', 'administrator'],\n      transitions: ['changesRequested', 'approved'],\n    },\n    {\n      id: 'changesRequested',\n      title: 'Changes requested',\n      color: 'warning',\n      roles: ['editor', 'administrator'],\n      transitions: ['approved'],\n    },\n    {\n      id: 'approved',\n      title: 'Approved',\n      color: 'success',\n      roles: ['administrator'],\n      transitions: ['changesRequested'],\n      requireAssignment: true,\n    },\n  ]),\n  filters: () => '',\n}\n","import React from 'react'\nimport {useToast} from '@sanity/ui'\nimport {UserSelectMenu} from 'sanity-plugin-utils'\nimport {useClient} from 'sanity'\n\nimport {User} from '../types'\nimport {API_VERSION} from '../constants'\n\ntype UserAssignmentProps = {\n  userList: User[]\n  assignees: string[]\n  documentId: string\n}\n\nexport default function UserAssignment(props: UserAssignmentProps) {\n  const {assignees, userList, documentId} = props\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n\n  const addAssignee = React.useCallback(\n    (userId: string) => {\n      const user = userList.find((u) => u.id === userId)\n\n      if (!userId || !user) {\n        return toast.push({\n          status: 'error',\n          title: 'Could not find User',\n        })\n      }\n\n      return client\n        .patch(`workflow-metadata.${documentId}`)\n        .setIfMissing({assignees: []})\n        .insert(`after`, `assignees[-1]`, [userId])\n        .commit()\n        .then(() => {\n          return toast.push({\n            title: `Added ${user.displayName} to assignees`,\n            status: 'success',\n          })\n        })\n        .catch((err) => {\n          console.error(err)\n\n          return toast.push({\n            title: `Failed to add assignee`,\n            description: userId,\n            status: 'error',\n          })\n        })\n    },\n    [documentId, client, toast, userList]\n  )\n\n  const removeAssignee = React.useCallback(\n    (userId: string) => {\n      const user = userList.find((u) => u.id === userId)\n\n      if (!userId || !user) {\n        return toast.push({\n          status: 'error',\n          title: 'Could not find User',\n        })\n      }\n\n      return client\n        .patch(`workflow-metadata.${documentId}`)\n        .unset([`assignees[@ == \"${userId}\"]`])\n        .commit()\n        .then(() => {\n          return toast.push({\n            title: `Removed ${user.displayName} from assignees`,\n            status: 'success',\n          })\n        })\n        .catch((err) => {\n          console.error(err)\n\n          return toast.push({\n            title: `Failed to remove assignee`,\n            description: documentId,\n            status: 'error',\n          })\n        })\n    },\n    [client, toast, documentId, userList]\n  )\n\n  const clearAssignees = React.useCallback(() => {\n    return client\n      .patch(`workflow-metadata.${documentId}`)\n      .unset([`assignees`])\n      .commit()\n      .then(() => {\n        return toast.push({\n          title: `Cleared assignees`,\n          status: 'success',\n        })\n      })\n      .catch((err) => {\n        console.error(err)\n\n        return toast.push({\n          title: `Failed to clear assignees`,\n          description: documentId,\n          status: 'error',\n        })\n      })\n  }, [client, toast, documentId])\n\n  return (\n    <UserSelectMenu\n      style={{maxHeight: 300}}\n      value={assignees || []}\n      userList={userList}\n      onAdd={addAssignee}\n      onClear={clearAssignees}\n      onRemove={removeAssignee}\n    />\n  )\n}\n","import {useMemo} from 'react'\nimport {useListeningQuery} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport {KeyedMetadata, Metadata} from '../types'\n\n/**\n * Takes the published ID of documents and return the metadata for those documents.\n *\n * @param ids Source document published IDs\n */\nexport function useWorkflowMetadata(ids: string[]): {\n  data: KeyedMetadata\n  loading: boolean\n  error: boolean | unknown | ProgressEvent\n} {\n  const {\n    data: rawData,\n    loading,\n    error,\n  } = useListeningQuery<Metadata[]>(\n    `*[_type == \"workflow.metadata\" && documentId in $ids]{\n      _id,\n      _type,\n      _rev,\n      assignees,\n      documentId,\n      state,\n      orderRank\n    }`,\n    {\n      params: {ids},\n      options: {apiVersion: API_VERSION},\n    }\n  )\n\n  const keyedMetadata = useMemo(() => {\n    if (!rawData || rawData.length === 0) return {}\n\n    return rawData.reduce<KeyedMetadata>((acc, cur) => {\n      return {\n        ...acc,\n        [cur.documentId]: cur,\n      }\n    }, {})\n  }, [rawData])\n\n  return {data: keyedMetadata, loading, error}\n}\n","import {useCallback, useContext, useState} from 'react'\nimport {createContext} from 'react'\nimport {LayoutProps} from 'sanity'\n\nimport {DEFAULT_CONFIG} from '../constants'\nimport {useWorkflowMetadata} from '../hooks/useWorkflowMetadata'\nimport {KeyedMetadata, WorkflowConfig} from '../types'\n\nexport type WorkflowContextValue = Required<WorkflowConfig> & {\n  data: KeyedMetadata\n  loading: boolean\n  error: boolean | unknown | ProgressEvent\n  ids: string[]\n  addId: (id: string) => void\n  removeId: (id: string) => void\n}\n\nconst WorkflowContext = createContext<WorkflowContextValue>({\n  data: {},\n  loading: false,\n  error: false,\n  ids: [],\n  addId: () => null,\n  removeId: () => null,\n  ...DEFAULT_CONFIG,\n})\n\nexport function useWorkflowContext(id?: string) {\n  const current = useContext(WorkflowContext)\n\n  return {...current, metadata: id ? current.data[id] : null}\n}\n\ntype WorkflowProviderProps = LayoutProps & {workflow: Required<WorkflowConfig>}\n\n/**\n * This Provider wraps the Studio and provides the workflow context to document actions and badges.\n * This is so individual actions and badges do not need to all register their own listeners.\n * Instead, each document \"signals\" its ID up to the provider, which then registers a single listener\n * This is performed inside of a component loaded at the root level of the Document Form\n */\nexport function WorkflowProvider(props: WorkflowProviderProps) {\n  const [ids, setIds] = useState<string[]>([])\n  const addId = useCallback(\n    (id: string) =>\n      setIds((current) => (current.includes(id) ? current : [...current, id])),\n    []\n  )\n  const removeId = useCallback(\n    (id: string) => setIds((current) => current.filter((i) => i !== id)),\n    []\n  )\n  const {data, loading, error} = useWorkflowMetadata(ids)\n\n  return (\n    <WorkflowContext.Provider\n      value={{\n        data,\n        loading,\n        error,\n        ids,\n        addId,\n        removeId,\n        states: props.workflow.states,\n        schemaTypes: props.workflow.schemaTypes,\n        filters: props.workflow.filters,\n      }}\n    >\n      {props.renderDefault(props)}\n    </WorkflowContext.Provider>\n  )\n}\n","import {UsersIcon} from '@sanity/icons'\nimport {useState} from 'react'\nimport {DocumentActionProps} from 'sanity'\nimport {useProjectUsers} from 'sanity-plugin-utils'\n\nimport UserAssignment from '../components/UserAssignment'\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\n\nexport function AssignWorkflow(props: DocumentActionProps) {\n  const {id} = props\n  const {metadata, loading, error} = useWorkflowContext(id)\n  const [isDialogOpen, setDialogOpen] = useState(false)\n  const userList = useProjectUsers({apiVersion: API_VERSION})\n\n  if (error) {\n    console.error(error)\n  }\n\n  if (!metadata) {\n    return null\n  }\n\n  return {\n    icon: UsersIcon,\n    type: 'dialog',\n    disabled: !metadata || loading || error,\n    label: `Assign`,\n    title: metadata ? null : `Document is not in Workflow`,\n    dialog: isDialogOpen && {\n      type: 'popover',\n      onClose: () => {\n        setDialogOpen(false)\n      },\n      content: (\n        <UserAssignment\n          userList={userList}\n          assignees={metadata?.assignees?.length > 0 ? metadata.assignees : []}\n          documentId={id}\n        />\n      ),\n    },\n    onHandle: () => {\n      setDialogOpen(true)\n    },\n  }\n}\n","import {SplitVerticalIcon} from '@sanity/icons'\nimport {useToast} from '@sanity/ui'\nimport {LexoRank} from 'lexorank'\nimport {useCallback, useState} from 'react'\nimport {DocumentActionProps, useClient} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\n\nexport function BeginWorkflow(props: DocumentActionProps) {\n  const {id, draft} = props\n  const {metadata, loading, error, states} = useWorkflowContext(id)\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n  const [beginning, setBeginning] = useState(false)\n  const [complete, setComplete] = useState(false)\n\n  if (error) {\n    console.error(error)\n  }\n\n  const handle = useCallback(async () => {\n    setBeginning(true)\n\n    const lowestOrderFirstState = await client.fetch(\n      `*[_type == \"workflow.metadata\" && state == $state]|order(orderRank)[0].orderRank`,\n      {state: states[0].id}\n    )\n\n    client\n      .createIfNotExists({\n        _id: `workflow-metadata.${id}`,\n        _type: `workflow.metadata`,\n        documentId: id,\n        state: states[0].id,\n        orderRank: lowestOrderFirstState\n          ? LexoRank.parse(lowestOrderFirstState).genNext().toString()\n          : LexoRank.min().toString(),\n        locale: draft?.locale,\n      })\n      .then(() => {\n        toast.push({\n          status: 'success',\n          title: 'Workflow started',\n          description: `Document is now \"${states[0].title}\"`,\n        })\n        setBeginning(false)\n        // Optimistically remove action\n        setComplete(true)\n      })\n  }, [id, states, client, toast])\n\n  if (!draft || complete || metadata) {\n    return null\n  }\n\n  return {\n    icon: SplitVerticalIcon,\n    type: 'dialog',\n    disabled: metadata || loading || error || beginning || complete,\n    label: beginning ? `Beginning...` : `Begin Workflow`,\n    onHandle: () => {\n      handle()\n    },\n  }\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {useCallback} from 'react'\nimport {DocumentActionProps, useClient} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\n\nexport function CompleteWorkflow(props: DocumentActionProps) {\n  const {id} = props\n  const {metadata, loading, error, states} = useWorkflowContext(id)\n  const client = useClient({apiVersion: API_VERSION})\n\n  if (error) {\n    console.error(error)\n  }\n\n  const handle = useCallback(() => {\n    client.delete(`workflow-metadata.${id}`)\n  }, [id, client])\n\n  if (!metadata) {\n    return null\n  }\n\n  const state = states.find((s) => s.id === metadata.state)\n  const isLastState = state?.id === states[states.length - 1].id\n\n  return {\n    icon: CheckmarkIcon,\n    type: 'dialog',\n    disabled: loading || error || !isLastState,\n    label: `Complete Workflow`,\n    title: isLastState\n      ? `Removes the document from the Workflow process`\n      : `Cannot remove from workflow until in the last state`,\n    onHandle: () => {\n      handle()\n    },\n    color: 'positive',\n  }\n}\n","export function arraysContainMatchingString(\n  one: string[],\n  two: string[]\n): boolean {\n  return one.some((item) => two.includes(item))\n}\n","import {ArrowLeftIcon, ArrowRightIcon} from '@sanity/icons'\nimport {useToast} from '@sanity/ui'\nimport {useCurrentUser, useValidationStatus} from 'sanity'\nimport {DocumentActionProps, useClient} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\nimport {arraysContainMatchingString} from '../helpers/arraysContainMatchingString'\nimport {State} from '../types'\n\n// eslint-disable-next-line complexity\nexport function UpdateWorkflow(props: DocumentActionProps, actionState: State) {\n  const {id, type} = props\n\n  const user = useCurrentUser()\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n  const currentUser = useCurrentUser()\n\n  const {metadata, loading, error, states} = useWorkflowContext(id)\n  const currentState = states.find((s) => s.id === metadata?.state)\n  const {assignees = []} = metadata ?? {}\n\n  // TODO: Shouldn't the document action props contain this?\n  const {validation, isValidating} = useValidationStatus(id, type)\n  const hasValidationErrors =\n    currentState?.requireValidation &&\n    !isValidating &&\n    validation?.length > 0 &&\n    validation.find((v) => v.level === 'error')\n\n  if (error) {\n    console.error(error)\n  }\n\n  const onHandle = (documentId: string, newState: State) => {\n    client\n      .patch(`workflow-metadata.${documentId}`)\n      .set({state: newState.id})\n      .commit()\n      .then(() => {\n        props.onComplete()\n        toast.push({\n          status: 'success',\n          title: `Document state now \"${newState.title}\"`,\n        })\n      })\n      .catch((err) => {\n        props.onComplete()\n        console.error(err)\n        toast.push({\n          status: 'error',\n          title: `Document state update failed`,\n        })\n      })\n  }\n\n  // Remove button if:\n  // Document is not in Workflow OR\n  // The current State is the same as this actions State\n  if (!metadata || (currentState && currentState.id === actionState.id)) {\n    return null\n  }\n\n  const currentStateIndex = states.findIndex((s) => s.id === currentState?.id)\n  const actionStateIndex = states.findIndex((s) => s.id === actionState.id)\n  const direction = actionStateIndex > currentStateIndex ? 'promote' : 'demote'\n  const DirectionIcon = direction === 'promote' ? ArrowRightIcon : ArrowLeftIcon\n  const directionLabel = direction === 'promote' ? 'Promote' : 'Demote'\n\n  const userRoleCanUpdateState =\n    user?.roles?.length && actionState?.roles?.length\n      ? // If the Action state is limited to specific roles\n        // check that the current user has one of those roles\n        arraysContainMatchingString(\n          user.roles.map((r) => r.name),\n          actionState.roles\n        )\n      : // No roles specified on the next state, so anyone can update\n        actionState?.roles?.length !== 0\n\n  const actionStateIsAValidTransition =\n    currentState?.id && currentState?.transitions?.length\n      ? // If the Current State limits transitions to specific States\n        // Check that the Action State is in Current State's transitions array\n        currentState.transitions.includes(actionState.id)\n      : // Otherwise this isn't a problem\n        true\n\n  const userAssignmentCanUpdateState = actionState.requireAssignment\n    ? // If the Action State requires assigned users\n      // Check the current user ID is in the assignees array\n      currentUser && assignees?.length && assignees.includes(currentUser.id)\n    : // Otherwise this isn't a problem\n      true\n\n  let title = `${directionLabel} State to \"${actionState.title}\"`\n\n  if (!userRoleCanUpdateState) {\n    title = `Your User role cannot ${directionLabel} State to \"${actionState.title}\"`\n  } else if (!actionStateIsAValidTransition) {\n    title = `You cannot ${directionLabel} State to \"${actionState.title}\" from \"${currentState?.title}\"`\n  } else if (!userAssignmentCanUpdateState) {\n    title = `You must be assigned to the document to ${directionLabel} State to \"${actionState.title}\"`\n  } else if (currentState?.requireValidation && isValidating) {\n    title = `Document is validating, cannot ${directionLabel} State to \"${actionState.title}\"`\n  } else if (hasValidationErrors) {\n    title = `Document has validation errors, cannot ${directionLabel} State to \"${actionState.title}\"`\n  }\n\n  return {\n    icon: DirectionIcon,\n    disabled:\n      loading ||\n      error ||\n      (currentState?.requireValidation && isValidating) ||\n      hasValidationErrors ||\n      !currentState ||\n      !userRoleCanUpdateState ||\n      !actionStateIsAValidTransition ||\n      !userAssignmentCanUpdateState,\n    title,\n    label: actionState.title,\n    onHandle: () => onHandle(id, actionState),\n  }\n}\n","import {CurrentUser, DocumentBadgeDescription} from 'sanity'\nimport {useProjectUsers} from 'sanity-plugin-utils'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\n\nexport function AssigneesBadge(\n  documentId: string,\n  currentUser: CurrentUser | null\n): DocumentBadgeDescription | null {\n  const {metadata, loading, error} = useWorkflowContext(documentId)\n  const userList = useProjectUsers({apiVersion: API_VERSION})\n\n  if (loading || error || !metadata) {\n    if (error) {\n      console.error(error)\n    }\n\n    return null\n  }\n\n  if (!metadata?.assignees?.length) {\n    return {\n      label: 'Unassigned',\n    }\n  }\n\n  const {assignees} = metadata ?? []\n  const hasMe = currentUser\n    ? assignees.some((assignee) => assignee === currentUser.id)\n    : false\n  const assigneesCount = hasMe ? assignees.length - 1 : assignees.length\n  const assigneeUsers = userList.filter((user) => assignees.includes(user.id))\n  const title = assigneeUsers.map((user) => user.displayName).join(', ')\n\n  let label\n\n  if (hasMe && assigneesCount === 0) {\n    label = 'Assigned to Me'\n  } else if (hasMe && assigneesCount > 0) {\n    label = `Me and ${assigneesCount} ${\n      assigneesCount === 1 ? 'other' : 'others'\n    }`\n  } else {\n    label = `${assigneesCount} assigned`\n  }\n\n  return {\n    label,\n    title,\n    color: 'primary',\n  }\n}\n","import {DocumentBadgeDescription} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\n\nexport function StateBadge(\n  documentId: string\n): DocumentBadgeDescription | null {\n  const {metadata, loading, error, states} = useWorkflowContext(documentId)\n  const state = states.find((s) => s.id === metadata?.state)\n\n  if (loading || error) {\n    if (error) {\n      console.error(error)\n    }\n\n    return null\n  }\n\n  if (!state) {\n    return null\n  }\n\n  return {\n    label: state.title,\n    // title: state.title,\n    color: state?.color,\n  }\n}\n","import {useEffect} from 'react'\nimport {ObjectInputProps} from 'sanity'\n\nimport {useWorkflowContext} from './WorkflowContext'\n\n// This component is loaded at the root level of the Document Form\n// It is used to signal the document ID to the WorkflowProvider\nexport default function WorkflowSignal(props: ObjectInputProps) {\n  const documentId = props?.value?._id\n    ? props.value._id.replace(`drafts.`, ``)\n    : null\n\n  const {addId, removeId} = useWorkflowContext()\n\n  useEffect(() => {\n    // On mount, add  to the query of listening documents\n    if (documentId) {\n      addId(documentId)\n    }\n\n    // On unmount, remove from the query of listening documents\n    return () => {\n      if (documentId) {\n        removeId(documentId)\n      }\n    }\n  }, [documentId, addId, removeId])\n\n  return props.renderDefault(props)\n}\n","import {Button} from '@sanity/ui'\nimport {EditIcon} from '@sanity/icons'\nimport {useRouter} from 'sanity/router'\n\ntype EditButtonProps = {\n  id: string\n  type: string\n  disabled?: boolean\n}\n\nexport default function EditButton(props: EditButtonProps) {\n  const {id, type, disabled = false} = props\n  const {navigateIntent} = useRouter()\n\n  return (\n    <Button\n      // eslint-disable-next-line react/jsx-no-bind\n      onClick={() => navigateIntent('edit', {id, type})}\n      mode=\"ghost\"\n      fontSize={1}\n      padding={2}\n      tabIndex={-1}\n      icon={EditIcon}\n      text=\"Edit\"\n      disabled={disabled}\n    />\n  )\n}\n","import {Flex, Card, Spinner} from '@sanity/ui'\nimport {Preview, SanityDocument, StringInputProps, useSchema} from 'sanity'\nimport {useListeningQuery, Feedback} from 'sanity-plugin-utils'\n\nimport EditButton from './EditButton'\n\n// TODO: Update this to use the same component as the Tool\nexport default function Field(props: StringInputProps) {\n  const schema = useSchema()\n  const {data, loading, error} = useListeningQuery<SanityDocument>(\n    `*[_id in [$id, $draftId]]|order(_updatedAt)[0]`,\n    {\n      params: {\n        id: String(props.value),\n        draftId: `drafts.${String(props.value)}`,\n      },\n    }\n  )\n\n  if (loading) {\n    return <Spinner />\n  }\n\n  const schemaType = schema.get(data?._type ?? ``)\n\n  if (error || !data?._type || !schemaType) {\n    return <Feedback tone=\"critical\" title=\"Error with query\" />\n  }\n\n  return (\n    <Card border padding={2}>\n      <Flex align=\"center\" justify=\"space-between\" gap={2}>\n        <Preview layout=\"default\" value={data} schemaType={schemaType} />\n        <EditButton id={data._id} type={data._type} />\n      </Flex>\n    </Card>\n  )\n}\n","import {Card} from '@sanity/ui'\nimport {FunctionComponent} from 'react'\nimport {ArraySchemaType, ArrayOfPrimitivesInputProps, useFormValue} from 'sanity'\nimport {useProjectUsers} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport UserAssignment from './UserAssignment'\n\nconst UserAssignmentInput: FunctionComponent<\n  ArrayOfPrimitivesInputProps<string | number | boolean, ArraySchemaType>\n> = (props) => {\n  const documentId = useFormValue([`documentId`])\n  const userList = useProjectUsers({apiVersion: API_VERSION})\n\n  const stringValue =\n    Array.isArray(props?.value) && props?.value?.length\n      ? props.value.map((item) => String(item))\n      : []\n\n  return (\n    <Card border padding={1}>\n      <UserAssignment userList={userList} assignees={stringValue} documentId={String(documentId)} />\n    </Card>\n  )\n}\n\nexport default UserAssignmentInput\n","import {LexoRank} from 'lexorank'\n\n// Use in initial value field by passing in the rank value of the last document\n// If not value passed, generate a sensibly low rank\nexport default function initialRank(lastRankValue = ``): string {\n  const lastRank =\n    lastRankValue && typeof lastRankValue === 'string'\n      ? LexoRank.parse(lastRankValue)\n      : LexoRank.min()\n  const nextRank = lastRank.genNext().genNext()\n\n  return (nextRank as any).value\n}\n","import {defineField, defineType} from 'sanity'\n\nimport Field from '../../components/DocumentCard/Field'\nimport UserAssignmentInput from '../../components/UserAssignmentInput'\nimport {API_VERSION} from '../../constants'\nimport initialRank from '../../helpers/initialRank'\nimport {State} from '../../types'\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport default (states: State[]) =>\n  defineType({\n    type: 'document',\n    name: 'workflow.metadata',\n    title: 'Workflow metadata',\n    liveEdit: true,\n    fields: [\n      defineField({\n        name: 'state',\n        description: `The current \"State\" of the document. Field is read only as changing it would not fire the state's \"operation\" setting. These are fired in the Document Actions and in the custom Tool.`,\n        readOnly: true,\n        type: 'string',\n        options: {\n          list: states.length\n            ? states.map((state) => ({\n                value: state.id,\n                title: state.title,\n              }))\n            : [],\n          layout: 'radio',\n        },\n      }),\n      defineField({\n        name: 'documentId',\n        title: 'Document ID',\n        description:\n          'Used to help identify the target document that this metadata is tracking state for.',\n        type: 'string',\n        readOnly: true,\n        components: {\n          input: Field,\n        },\n      }),\n      defineField({\n        name: 'orderRank',\n        description: 'Used to maintain order position of cards in the Tool.',\n        type: 'string',\n        readOnly: true,\n        initialValue: async (p, {getClient}) => {\n          const lastDocOrderRank = await getClient({\n            apiVersion: API_VERSION,\n          }).fetch(`*[_type == $type]|order(@[$order] desc)[0][$order]`, {\n            order: `orderRank`,\n            type: `workflow.metadata`,\n          })\n\n          return initialRank(lastDocOrderRank)\n        },\n      }),\n      defineField({\n        type: 'array',\n        name: 'assignees',\n        of: [{type: 'string'}],\n        components: {\n          input: UserAssignmentInput,\n        },\n      }),\n    ],\n  })\n","import {SanityDocumentWithMetadata} from '../types'\n\nexport function filterItemsAndSort(\n  items: SanityDocumentWithMetadata[],\n  stateId: string,\n  selectedUsers: string[] = [],\n  selectedSchemaTypes: null | string[] = []\n): SanityDocumentWithMetadata[] {\n  return (\n    items\n      // Only items that have existing documents\n      .filter((item) => item?._id)\n      // Only items of this state\n      .filter((item) => item?._metadata?.state === stateId)\n      // Only items with selected users, if the document has any assigned users\n      .filter((item) =>\n        selectedUsers.length && item._metadata?.assignees?.length\n          ? item._metadata?.assignees.some((assignee) =>\n              selectedUsers.includes(assignee)\n            )\n          : !selectedUsers.length\n      )\n      // Only items of selected schema types, if any are selected\n      .filter((item) => {\n        if (!selectedSchemaTypes) {\n          return true\n        }\n\n        return selectedSchemaTypes.length\n          ? selectedSchemaTypes.includes(item._type)\n          : false\n      })\n      // Sort by metadata orderRank, a string field\n      .sort((a, b) => {\n        const aOrderRank = a._metadata?.orderRank || '0'\n        const bOrderRank = b._metadata?.orderRank || '0'\n\n        return aOrderRank.localeCompare(bOrderRank)\n      })\n  )\n}\n","import {DraggableLocation} from '@hello-pangea/dnd'\nimport {useToast} from '@sanity/ui'\nimport groq from 'groq'\nimport React from 'react'\nimport {useClient} from 'sanity'\nimport {useListeningQuery} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport {SanityDocumentWithMetadata, State} from '../types'\n\ntype WorkflowDocuments = {\n  workflowData: {\n    data: SanityDocumentWithMetadata[]\n    loading: boolean\n    error: boolean | unknown | ProgressEvent\n  }\n  operations: {\n    move: (\n      draggedId: string,\n      destination: DraggableLocation,\n      states: State[],\n      newOrder: string\n    ) => void\n  }\n}\n\nexport function useWorkflowDocuments(\n  schemaTypes: string[],\n  filtered?: string\n): WorkflowDocuments {\n  const toast = useToast()\n  const client = useClient({apiVersion: API_VERSION})\n\n  const localeFilter = filtered ?? ''\n\n  const QUERY = groq`*[_type == \"workflow.metadata\" ${localeFilter}]|order(orderRank){\n    \"_metadata\": {\n      _rev,\n      assignees,\n      documentId,\n      state,\n      orderRank,\n      \"draftDocumentId\": \"drafts.\" + documentId,\n    }\n  }{\n    ...,\n    ...(\n      *[_id == ^._metadata.documentId || _id == ^._metadata.draftDocumentId]|order(_updatedAt)[0]{ \n        _id, \n        _type, \n        _rev, \n        _updatedAt \n      }\n    )\n  }`\n\n  // Get and listen to changes on documents + workflow metadata documents\n  const {data, loading, error} = useListeningQuery<\n    SanityDocumentWithMetadata[]\n  >(QUERY, {\n    params: {schemaTypes},\n    initialValue: [],\n  })\n\n  const [localDocuments, setLocalDocuments] = React.useState<\n    SanityDocumentWithMetadata[]\n  >([])\n\n  React.useEffect(() => {\n    if (data) {\n      setLocalDocuments(data)\n    }\n  }, [data])\n\n  const move = React.useCallback(\n    async (\n      draggedId: string,\n      destination: DraggableLocation,\n      states: State[],\n      newOrder: string\n    ) => {\n      // Optimistic update\n      const currentLocalData = localDocuments\n      const newLocalDocuments = localDocuments.map((item) => {\n        if (item?._metadata?.documentId === draggedId) {\n          return {\n            ...item,\n            _metadata: {\n              ...item._metadata,\n              state: destination.droppableId,\n              orderRank: newOrder,\n              // This value won't be written to the document\n              // It's done so that un/publish operations don't happen twice\n              // Because a moved document's card will update once optimistically\n              // and then again when the document is updated\n              optimistic: true,\n            },\n          }\n        }\n\n        return item\n      })\n\n      setLocalDocuments(newLocalDocuments)\n\n      // Now client-side update\n      const newStateId = destination.droppableId\n      const newState = states.find((s) => s.id === newStateId)\n      const document = localDocuments.find(\n        (d) => d?._metadata?.documentId === draggedId\n      )\n\n      if (!newState?.id) {\n        toast.push({\n          title: `Could not find target state ${newStateId}`,\n          status: 'error',\n        })\n        return null\n      }\n\n      if (!document) {\n        toast.push({\n          title: `Could not find dragged document in data`,\n          status: 'error',\n        })\n        return null\n      }\n\n      // We need to know if it's a draft or not\n      const {_id, _type} = document\n\n      // Metadata + useDocumentOperation always uses Published id\n      const {documentId, _rev} = document._metadata || {}\n\n      await client\n        .patch(`workflow-metadata.${documentId}`)\n        .ifRevisionId(_rev)\n        .set({state: newStateId, orderRank: newOrder})\n        .commit()\n        .then((res) => {\n          toast.push({\n            title:\n              newState.id === document._metadata.state\n                ? `Reordered in \"${newState?.title ?? newStateId}\"`\n                : `Moved to \"${newState?.title ?? newStateId}\"`,\n            status: 'success',\n          })\n          return res\n        })\n        .catch((err) => {\n          // Revert optimistic update\n          setLocalDocuments(currentLocalData)\n\n          toast.push({\n            title: `Failed to move to \"${newState?.title ?? newStateId}\"`,\n            description: err.message,\n            status: 'error',\n          })\n          return null\n        })\n\n      // Send back to the workflow board so a document update can happen\n      return {_id, _type, documentId, state: newState as State}\n    },\n    [client, toast, localDocuments]\n  )\n\n  return {\n    workflowData: {data: localDocuments, loading, error},\n    operations: {move},\n  }\n}\n","import React from 'react'\nimport {Box, Flex, Text} from '@sanity/ui'\nimport {useCurrentUser, UserAvatar} from 'sanity'\n\nimport {User} from '../../types'\n\ntype AvatarGroupProps = {\n  users: User[]\n  max?: number\n}\n\nexport default function AvatarGroup(props: AvatarGroupProps) {\n  const currentUser = useCurrentUser()\n  const {users, max = 4} = props\n\n  const len = users?.length\n  const {me, visibleUsers} = React.useMemo(() => {\n    return {\n      me: currentUser?.id ? users.find((u) => u.id === currentUser.id) : undefined,\n      visibleUsers: users.filter((u) => u.id !== currentUser?.id).slice(0, max - 1),\n    }\n  }, [users, max, currentUser])\n\n  if (!users?.length) {\n    return null\n  }\n\n  return (\n    <Flex align=\"center\" gap={1}>\n      {me ? <UserAvatar user={me} /> : null}\n      {visibleUsers.map((user) => (\n        <Box key={user.id} style={{marginRight: -8}}>\n          <UserAvatar user={user} />\n        </Box>\n      ))}\n      {len > max && (\n        <Box paddingLeft={2}>\n          <Text size={1}>+{len - max}</Text>\n        </Box>\n      )}\n    </Flex>\n  )\n}\n","import React from 'react'\nimport {Button, Grid, Popover, useClickOutside} from '@sanity/ui'\nimport {AddIcon} from '@sanity/icons'\n\nimport AvatarGroup from './DocumentCard/AvatarGroup'\nimport {User} from '../types'\nimport UserAssignment from './UserAssignment'\n\ntype UserDisplayProps = {\n  userList: User[]\n  assignees: string[]\n  documentId: string\n  disabled?: boolean\n}\n\nexport default function UserDisplay(props: UserDisplayProps) {\n  const {assignees, userList, documentId, disabled = false} = props\n\n  const [button] = React.useState(null)\n  const [popover, setPopover] = React.useState(null)\n  const [isOpen, setIsOpen] = React.useState(false)\n\n  const close = React.useCallback(() => setIsOpen(false), [])\n  const open = React.useCallback(() => setIsOpen(true), [])\n\n  useClickOutside(close, [button, popover])\n\n  return (\n    <Popover\n      // @ts-ignore\n      ref={setPopover}\n      content={<UserAssignment userList={userList} assignees={assignees} documentId={documentId} />}\n      portal\n      open={isOpen}\n    >\n      {!assignees || assignees.length === 0 ? (\n        <Button\n          onClick={open}\n          fontSize={1}\n          padding={2}\n          tabIndex={-1}\n          icon={AddIcon}\n          text=\"Assign\"\n          tone=\"positive\"\n          mode=\"ghost\"\n          disabled={disabled}\n        />\n      ) : (\n        <Grid>\n          <Button onClick={open} padding={0} mode=\"bleed\" disabled={disabled}>\n            <AvatarGroup users={userList.filter((u) => assignees.includes(u.id))} />\n          </Button>\n        </Grid>\n      )}\n    </Popover>\n  )\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {Box, Button, Text, Tooltip, useToast} from '@sanity/ui'\nimport React from 'react'\nimport {useClient} from 'sanity'\n\nimport {API_VERSION} from '../../constants'\n\ntype CompleteButtonProps = {\n  documentId: string\n  disabled: boolean\n}\n\nexport default function CompleteButton(props: CompleteButtonProps) {\n  const {documentId, disabled = false} = props\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n\n  const handleComplete: React.MouseEventHandler<HTMLButtonElement> =\n    React.useCallback(\n      (event) => {\n        const id = event.currentTarget.value\n\n        if (!id) {\n          return\n        }\n\n        client\n          .delete(`workflow-metadata.${id}`)\n          .then(() => {\n            toast.push({\n              status: 'success',\n              title: 'Workflow completed',\n            })\n          })\n          .catch(() => {\n            toast.push({\n              status: 'error',\n              title: 'Could not complete Workflow',\n            })\n          })\n      },\n      [client, toast]\n    )\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>Remove this document from Workflow</Text>\n        </Box>\n      }\n    >\n      <Button\n        value={documentId}\n        onClick={handleComplete}\n        text=\"Complete\"\n        icon={CheckmarkIcon}\n        tone=\"positive\"\n        mode=\"ghost\"\n        fontSize={1}\n        padding={2}\n        tabIndex={-1}\n        disabled={disabled}\n      />\n    </Tooltip>\n  )\n}\n","import {useTimeAgo} from 'sanity'\n\nexport interface TimeAgoProps {\n  time: string | Date\n}\n\nexport function TimeAgo({time}: TimeAgoProps) {\n  const timeAgo = useTimeAgo(time)\n\n  return <span title={timeAgo}>{timeAgo} ago</span>\n}\n","import {EditIcon} from '@sanity/icons'\nimport {PreviewValue, SanityDocument} from '@sanity/types'\nimport {Box, Text, Tooltip} from '@sanity/ui'\nimport {TextWithTone} from 'sanity'\n\nimport {TimeAgo} from './TimeAgo'\n\nexport function DraftStatus(props: {document?: PreviewValue | Partial<SanityDocument> | null}) {\n  const {document} = props\n  const updatedAt = document && '_updatedAt' in document && document._updatedAt\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>\n            {document ? (\n              <>Edited {updatedAt && <TimeAgo time={updatedAt} />}</>\n            ) : (\n              <>No unpublished edits</>\n            )}\n          </Text>\n        </Box>\n      }\n    >\n      <TextWithTone tone=\"caution\" dimmed={!document} muted={!document} size={1}>\n        <EditIcon />\n      </TextWithTone>\n    </Tooltip>\n  )\n}\n","import {PublishIcon} from '@sanity/icons'\nimport {PreviewValue, SanityDocument} from '@sanity/types'\nimport {Box, Text, Tooltip} from '@sanity/ui'\nimport {TextWithTone} from 'sanity'\n\nimport {TimeAgo} from './TimeAgo'\n\nexport function PublishedStatus(props: {\n  document?: PreviewValue | Partial<SanityDocument> | null\n}) {\n  const {document} = props\n  const updatedAt = document && '_updatedAt' in document && document._updatedAt\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>\n            {document ? (\n              <>Published {updatedAt && <TimeAgo time={updatedAt} />}</>\n            ) : (\n              <>Not published</>\n            )}\n          </Text>\n        </Box>\n      }\n    >\n      <TextWithTone\n        tone=\"positive\"\n        dimmed={!document}\n        muted={!document}\n        size={1}\n      >\n        <PublishIcon />\n      </TextWithTone>\n    </Tooltip>\n  )\n}\n","import {useEffect} from 'react'\nimport {useValidationStatus, ValidationStatus} from 'sanity'\n\ntype ValidateProps = {\n  documentId: string\n  type: string\n  onChange: (validation: ValidationStatus) => void\n}\n\n// Document validation is siloed into its own component\n// Because it's not performant to run on a lot of documents\nexport default function Validate(props: ValidateProps) {\n  const {documentId, type, onChange} = props\n  const {isValidating, validation = []} = useValidationStatus(documentId, type)\n\n  useEffect(() => {\n    onChange({isValidating, validation})\n  }, [onChange, isValidating, validation])\n\n  return null\n}\n","import {ErrorOutlineIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {ValidationMarker} from '@sanity/types'\nimport {Box, Text, Tooltip} from '@sanity/ui'\nimport {TextWithTone} from 'sanity'\n\ntype ValidationStatusProps = {\n  validation: ValidationMarker[]\n}\n\nexport function ValidationStatus(props: ValidationStatusProps) {\n  const {validation = []} = props\n\n  if (!validation.length) {\n    return null\n  }\n\n  const hasError = validation.some((item) => item.level === 'error')\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>\n            {validation.length === 1\n              ? `1 validation issue`\n              : `${validation.length} validation issues`}\n          </Text>\n        </Box>\n      }\n    >\n      <TextWithTone tone={hasError ? `critical` : `caution`} size={1}>\n        {hasError ? <ErrorOutlineIcon /> : <WarningOutlineIcon />}\n      </TextWithTone>\n    </Tooltip>\n  )\n}\n","/* eslint-disable react/prop-types */\nimport {DragHandleIcon} from '@sanity/icons'\nimport {Box, Card, CardTone, Flex, Stack, useTheme} from '@sanity/ui'\nimport {useCallback, useEffect, useMemo, useState} from 'react'\nimport {\n  SchemaType,\n  useSchema,\n  ValidationStatus as ValidationStatusType,\n} from 'sanity'\nimport {Preview} from 'sanity'\n\nimport {SanityDocumentWithMetadata, State, User} from '../../types'\nimport UserDisplay from '../UserDisplay'\nimport CompleteButton from './CompleteButton'\nimport {DraftStatus} from './core/DraftStatus'\nimport {PublishedStatus} from './core/PublishedStatus'\nimport EditButton from './EditButton'\nimport Validate from './Validate'\nimport {ValidationStatus} from './ValidationStatus'\n\ntype DocumentCardProps = {\n  isDragDisabled: boolean\n  isPatching: boolean\n  userRoleCanDrop: boolean\n  isDragging: boolean\n  item: SanityDocumentWithMetadata\n  states: State[]\n  toggleInvalidDocumentId: (\n    documentId: string,\n    action: 'ADD' | 'REMOVE'\n  ) => void\n  userList: User[]\n}\n\nexport function DocumentCard(props: DocumentCardProps) {\n  const {\n    isDragDisabled,\n    isPatching,\n    userRoleCanDrop,\n    isDragging,\n    item,\n    states,\n    toggleInvalidDocumentId,\n    userList,\n  } = props\n  const {assignees = [], documentId} = item._metadata ?? {}\n  const schema = useSchema()\n  const state = states.find((s) => s.id === item._metadata?.state)\n\n  const isDarkMode = useTheme().sanity.color.dark\n  const defaultCardTone = isDarkMode ? `transparent` : `default`\n\n  // Validation only runs if the state requests it\n  // Because it's not performant to run it on many documents simultaneously\n  // So we fake it here, and maybe set it inside <Validate />\n  const [optimisticValidation, setOptimisticValidation] =\n    useState<ValidationStatusType>({\n      isValidating: state?.requireValidation ?? false,\n      validation: [],\n    })\n\n  const {isValidating, validation} = optimisticValidation\n\n  const handleValidation = useCallback((updates: ValidationStatusType) => {\n    setOptimisticValidation(updates)\n  }, [])\n\n  const cardTone = useMemo(() => {\n    let tone: CardTone = defaultCardTone\n\n    if (!userRoleCanDrop) return isDarkMode ? `default` : `transparent`\n    if (!documentId) return tone\n    if (isPatching) tone = isDarkMode ? `default` : `transparent`\n    if (isDragging) tone = `positive`\n\n    if (state?.requireValidation && !isValidating && validation.length > 0) {\n      if (validation.some((v) => v.level === 'error')) {\n        tone = `critical`\n      } else {\n        tone = `caution`\n      }\n    }\n\n    return tone\n  }, [\n    defaultCardTone,\n    userRoleCanDrop,\n    isPatching,\n    isDarkMode,\n    documentId,\n    isDragging,\n    isValidating,\n    validation,\n    state?.requireValidation,\n  ])\n\n  // Update validation status\n  // Cannot be done in the above memo because it would set state during render\n  useEffect(() => {\n    if (!isValidating && validation.length > 0) {\n      if (validation.some((v) => v.level === 'error')) {\n        toggleInvalidDocumentId(documentId, 'ADD')\n      } else {\n        toggleInvalidDocumentId(documentId, 'REMOVE')\n      }\n    } else {\n      toggleInvalidDocumentId(documentId, 'REMOVE')\n    }\n  }, [documentId, isValidating, toggleInvalidDocumentId, validation])\n\n  const hasError = useMemo(\n    () => (isValidating ? false : validation.some((v) => v.level === 'error')),\n    [isValidating, validation]\n  )\n\n  const isLastState = useMemo(\n    () => states[states.length - 1].id === item._metadata?.state,\n    [states, item._metadata.state]\n  )\n\n  return (\n    <>\n      {state?.requireValidation ? (\n        <Validate\n          documentId={documentId}\n          type={item._type}\n          onChange={handleValidation}\n        />\n      ) : null}\n      <Box paddingBottom={3} paddingX={3}>\n        <Card radius={2} shadow={isDragging ? 3 : 1} tone={cardTone}>\n          <Stack>\n            <Card\n              borderBottom\n              radius={2}\n              paddingRight={2}\n              tone={cardTone}\n              style={{pointerEvents: 'none'}}\n            >\n              <Flex align=\"center\" justify=\"space-between\" gap={1}>\n                <Box flex={1}>\n                  <Preview\n                    layout=\"default\"\n                    skipVisibilityCheck\n                    value={item}\n                    schemaType={schema.get(item._type) as SchemaType}\n                  />\n                </Box>\n                <Box style={{flexShrink: 0}}>\n                  {hasError || isDragDisabled || isPatching ? null : (\n                    <DragHandleIcon />\n                  )}\n                </Box>\n              </Flex>\n            </Card>\n\n            <Card padding={2} radius={2} tone=\"inherit\">\n              <Flex align=\"center\" justify=\"space-between\" gap={3}>\n                <Box flex={1}>\n                  {documentId && (\n                    <UserDisplay\n                      userList={userList}\n                      assignees={assignees}\n                      documentId={documentId}\n                      disabled={!userRoleCanDrop}\n                    />\n                  )}\n                </Box>\n                {validation.length > 0 ? (\n                  <ValidationStatus validation={validation} />\n                ) : null}\n                <DraftStatus document={item} />\n                <PublishedStatus document={item} />\n                <EditButton\n                  id={item._id}\n                  type={item._type}\n                  disabled={!userRoleCanDrop}\n                />\n                {isLastState && states.length <= 3 ? (\n                  <CompleteButton\n                    documentId={documentId}\n                    disabled={!userRoleCanDrop}\n                  />\n                ) : null}\n              </Flex>\n              {isLastState && states.length > 3 ? (\n                <Stack paddingTop={2}>\n                  <CompleteButton\n                    documentId={documentId}\n                    disabled={!userRoleCanDrop}\n                  />\n                </Stack>\n              ) : null}\n            </Card>\n          </Stack>\n        </Card>\n      </Box>\n    </>\n  )\n}\n","import {Draggable, DraggableStyle} from '@hello-pangea/dnd'\nimport {useVirtualizer, VirtualItem} from '@tanstack/react-virtual'\nimport {CSSProperties, useMemo, useRef} from 'react'\nimport {CurrentUser} from 'sanity'\nimport {UserExtended} from 'sanity-plugin-utils'\n\nimport {filterItemsAndSort} from '../helpers/filterItemsAndSort'\nimport {SanityDocumentWithMetadata, State} from '../types'\nimport {DocumentCard} from './DocumentCard'\n\ntype DocumentListProps = {\n  data: SanityDocumentWithMetadata[]\n  invalidDocumentIds: string[]\n  patchingIds: string[]\n  selectedSchemaTypes: string[]\n  selectedUserIds: string[]\n  state: State\n  states: State[]\n  toggleInvalidDocumentId: (\n    documentId: string,\n    action: 'ADD' | 'REMOVE'\n  ) => void\n  user: CurrentUser | null\n  userList: UserExtended[]\n  userRoleCanDrop: boolean\n}\n\nfunction getStyle(\n  draggableStyle: DraggableStyle | undefined,\n  virtualItem: VirtualItem\n): CSSProperties {\n  // Default transform required by tanstack virtual for positioning\n  let transform = `translateY(${virtualItem.start}px)`\n\n  // If a card is being dragged over, this card needs to move up or down\n  if (draggableStyle && draggableStyle.transform) {\n    // So get the transform value from beautiful-dnd\n    const draggableTransformY = parseInt(\n      draggableStyle.transform.split(',')[1].split('px')[0],\n      10\n    )\n\n    // And apply it to the card\n    transform = `translateY(${virtualItem.start + draggableTransformY}px)`\n  }\n\n  return {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: `${virtualItem.size}px`,\n    transform,\n  }\n}\n\nexport default function DocumentList(props: DocumentListProps) {\n  const {\n    data = [],\n    invalidDocumentIds,\n    patchingIds,\n    selectedSchemaTypes,\n    selectedUserIds,\n    state,\n    states,\n    toggleInvalidDocumentId,\n    user,\n    userList,\n    userRoleCanDrop,\n  } = props\n\n  const dataFiltered = useMemo(() => {\n    return data.length\n      ? filterItemsAndSort(data, state.id, selectedUserIds, selectedSchemaTypes)\n      : []\n  }, [data, selectedSchemaTypes, selectedUserIds, state.id])\n\n  const parentRef = useRef(null)\n\n  const virtualizer = useVirtualizer({\n    count: dataFiltered.length,\n    getScrollElement: () => parentRef.current,\n    getItemKey: (index) => dataFiltered[index]?._metadata?.documentId ?? index,\n    estimateSize: () => 115,\n    overscan: 7,\n    measureElement: (element) => {\n      return element.getBoundingClientRect().height || 115\n    },\n  })\n\n  if (!data.length || !dataFiltered.length) {\n    return null\n  }\n\n  return (\n    <div\n      ref={parentRef}\n      style={{\n        height: `100%`,\n        overflow: 'auto',\n        // Smooths scrollbar behaviour\n        overflowAnchor: 'none',\n        scrollBehavior: 'auto',\n        paddingTop: 1,\n      }}\n    >\n      <div\n        style={{\n          height: `${virtualizer.getTotalSize()}px`,\n          width: '100%',\n          position: 'relative',\n        }}\n      >\n        {virtualizer.getVirtualItems().map((virtualItem) => {\n          const item = dataFiltered[virtualItem.index]\n\n          const {documentId, assignees} = item?._metadata ?? {}\n\n          const isInvalid = invalidDocumentIds.includes(documentId)\n          const meInAssignees = user?.id ? assignees?.includes(user.id) : false\n          const isDragDisabled =\n            patchingIds.includes(documentId) ||\n            !userRoleCanDrop ||\n            isInvalid ||\n            !(state.requireAssignment\n              ? state.requireAssignment && meInAssignees\n              : true)\n\n          return (\n            <Draggable\n              key={virtualItem.key}\n              draggableId={documentId}\n              index={virtualItem.index}\n              isDragDisabled={isDragDisabled}\n            >\n              {(draggableProvided, draggableSnapshot) => (\n                <div\n                  ref={draggableProvided.innerRef}\n                  {...draggableProvided.draggableProps}\n                  {...draggableProvided.dragHandleProps}\n                  style={getStyle(\n                    draggableProvided.draggableProps.style,\n                    virtualItem\n                  )}\n                >\n                  <div\n                    ref={virtualizer.measureElement}\n                    data-index={virtualItem.index}\n                  >\n                    <DocumentCard\n                      userRoleCanDrop={userRoleCanDrop}\n                      isDragDisabled={isDragDisabled}\n                      isPatching={patchingIds.includes(documentId)}\n                      isDragging={draggableSnapshot.isDragging}\n                      item={item}\n                      toggleInvalidDocumentId={toggleInvalidDocumentId}\n                      userList={userList}\n                      states={states}\n                    />\n                  </div>\n                </div>\n              )}\n            </Draggable>\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n","import {ResetIcon, UserIcon} from '@sanity/icons'\nimport {Button, Card, Flex, Menu, MenuButton} from '@sanity/ui'\nimport {useCallback} from 'react'\nimport {useCurrentUser, UserAvatar, useSchema} from 'sanity'\nimport {UserExtended, UserSelectMenu} from 'sanity-plugin-utils'\n\ntype FiltersProps = {\n  uniqueAssignedUsers: UserExtended[]\n  selectedUserIds: string[]\n  schemaTypes: string[]\n  selectedSchemaTypes: string[]\n  toggleSelectedUser: (userId: string) => void\n  resetSelectedUsers: () => void\n  toggleSelectedSchemaType: (schemaType: string) => void\n}\n\nexport default function Filters(props: FiltersProps) {\n  const {\n    uniqueAssignedUsers = [],\n    selectedUserIds,\n    schemaTypes,\n    selectedSchemaTypes,\n    toggleSelectedUser,\n    resetSelectedUsers,\n    toggleSelectedSchemaType,\n  } = props\n\n  const currentUser = useCurrentUser()\n  const schema = useSchema()\n\n  const onAdd = useCallback(\n    (id: string) => {\n      if (!selectedUserIds.includes(id)) {\n        toggleSelectedUser(id)\n      }\n    },\n    [selectedUserIds, toggleSelectedUser]\n  )\n\n  const onRemove = useCallback(\n    (id: string) => {\n      if (selectedUserIds.includes(id)) {\n        toggleSelectedUser(id)\n      }\n    },\n    [selectedUserIds, toggleSelectedUser]\n  )\n\n  const onClear = useCallback(() => {\n    resetSelectedUsers()\n  }, [resetSelectedUsers])\n\n  if (uniqueAssignedUsers.length === 0 && schemaTypes.length < 2) {\n    return null\n  }\n\n  const meInUniqueAssignees =\n    currentUser?.id && uniqueAssignedUsers.find((u) => u.id === currentUser.id)\n  const uniqueAssigneesNotMe = uniqueAssignedUsers.filter(\n    (u) => u.id !== currentUser?.id\n  )\n\n  return (\n    <Card tone=\"primary\" padding={2} borderBottom style={{overflowX: 'hidden'}}>\n      <Flex align=\"center\">\n        <Flex align=\"center\" gap={1} flex={1}>\n          {uniqueAssignedUsers.length > 5 ? (\n            <Card tone=\"default\">\n              <MenuButton\n                button={\n                  <Button\n                    padding={3}\n                    fontSize={1}\n                    text=\"Filter Assignees\"\n                    tone=\"primary\"\n                    icon={UserIcon}\n                  />\n                }\n                id=\"user-filters\"\n                menu={\n                  <Menu>\n                    <UserSelectMenu\n                      value={selectedUserIds}\n                      userList={uniqueAssignedUsers}\n                      onAdd={onAdd}\n                      onRemove={onRemove}\n                      onClear={onClear}\n                      labels={{\n                        addMe: 'Filter mine',\n                        removeMe: 'Clear mine',\n                        clear: 'Clear filters',\n                      }}\n                    />\n                  </Menu>\n                }\n                popover={{portal: true}}\n              />\n            </Card>\n          ) : (\n            <>\n              {meInUniqueAssignees ? (\n                <>\n                  <Button\n                    padding={0}\n                    mode={\n                      selectedUserIds.includes(currentUser.id)\n                        ? `default`\n                        : `bleed`\n                    }\n                    onClick={() => toggleSelectedUser(currentUser.id)}\n                  >\n                    <Flex padding={1} align=\"center\" justify=\"center\">\n                      <UserAvatar user={currentUser.id} size={1} withTooltip />\n                    </Flex>\n                  </Button>\n                  <Card borderRight style={{height: 30}} tone=\"inherit\" />\n                </>\n              ) : null}\n              {uniqueAssigneesNotMe.map((user) => (\n                <Button\n                  key={user.id}\n                  padding={0}\n                  mode={selectedUserIds.includes(user.id) ? `default` : `bleed`}\n                  onClick={() => toggleSelectedUser(user.id)}\n                >\n                  <Flex padding={1} align=\"center\" justify=\"center\">\n                    <UserAvatar user={user} size={1} withTooltip />\n                  </Flex>\n                </Button>\n              ))}\n\n              {selectedUserIds.length > 0 ? (\n                <Button\n                  padding={3}\n                  fontSize={1}\n                  text=\"Clear\"\n                  onClick={resetSelectedUsers}\n                  mode=\"ghost\"\n                  icon={ResetIcon}\n                />\n              ) : null}\n            </>\n          )}\n        </Flex>\n\n        {schemaTypes.length > 1 ? (\n          <Flex align=\"center\" gap={1}>\n            {schemaTypes.map((typeName) => {\n              const schemaType = schema.get(typeName)\n\n              if (!schemaType) {\n                return null\n              }\n\n              return (\n                <Button\n                  padding={3}\n                  fontSize={1}\n                  key={typeName}\n                  text={schemaType?.title ?? typeName}\n                  icon={schemaType?.icon ?? undefined}\n                  mode={\n                    selectedSchemaTypes.includes(typeName) ? `default` : `ghost`\n                  }\n                  onClick={() => toggleSelectedSchemaType(typeName)}\n                />\n              )\n            })}\n          </Flex>\n        ) : null}\n      </Flex>\n    </Card>\n  )\n}\n","import React from 'react'\nimport {Box, Text, Tooltip} from '@sanity/ui'\n\ntype StatusProps = {\n  text: string\n  icon: React.ComponentType\n}\n\nexport function Status(props: StatusProps) {\n  const {text, icon} = props\n  const Icon = icon\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>{text}</Text>\n        </Box>\n      }\n    >\n      <Text size={1}>\n        <Icon />\n      </Text>\n    </Tooltip>\n  )\n}\n","import {InfoOutlineIcon, UserIcon} from '@sanity/icons'\nimport {Badge, BadgeTone, Box, Card, Flex, Text} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nimport {State} from '../../types'\nimport {Status} from './Status'\n\nconst StyledStickyCard = styled(Card)(\n  () => css`\n    position: sticky;\n    top: 0;\n    z-index: 1;\n  `\n)\n\ntype StateTitleProps = {\n  state: State\n  requireAssignment: boolean\n  userRoleCanDrop: boolean\n  isDropDisabled: boolean\n  draggingFrom: string\n  documentCount: number\n}\n\nexport default function StateTitle(props: StateTitleProps) {\n  const {\n    state,\n    requireAssignment,\n    userRoleCanDrop,\n    isDropDisabled,\n    draggingFrom,\n    documentCount,\n  } = props\n\n  let tone: BadgeTone = 'default'\n  const isSource = draggingFrom === state.id\n\n  if (draggingFrom) {\n    tone = isDropDisabled || isSource ? 'default' : 'positive'\n  }\n\n  return (\n    <StyledStickyCard paddingY={4} padding={3} tone=\"inherit\">\n      <Flex gap={3} align=\"center\">\n        <Badge\n          mode={\n            (draggingFrom && !isDropDisabled) || isSource\n              ? 'default'\n              : 'outline'\n          }\n          tone={tone}\n          muted={!userRoleCanDrop || isDropDisabled}\n        >\n          {state.title}\n        </Badge>\n        {userRoleCanDrop ? null : (\n          <Status\n            text=\"You do not have permissions to move documents to this State\"\n            icon={InfoOutlineIcon}\n          />\n        )}\n        {requireAssignment ? (\n          <Status\n            text=\"You must be assigned to the document to move documents to this State\"\n            icon={UserIcon}\n          />\n        ) : null}\n        <Box flex={1}>\n          {documentCount > 0 ? (\n            <Text weight=\"semibold\" align=\"right\" size={1}>\n              {documentCount}\n            </Text>\n          ) : null}\n        </Box>\n      </Flex>\n    </StyledStickyCard>\n  )\n}\n","import {LexoRank} from 'lexorank'\n\nfunction generateMiddleValue(ranks: (LexoRank | undefined)[]) {\n  // Has no undefined values\n  if (!ranks.some((rank) => !rank)) {\n    return ranks\n  }\n\n  // Find the first undefined value\n  const firstUndefined = ranks.findIndex((rank) => !rank)\n\n  // Find the first defined value after the undefined value\n  const firstDefinedAfter = ranks.findIndex(\n    (rank, index) => rank && index > firstUndefined\n  )\n  // Find the first defined value before the undefined value\n  const firstDefinedBefore = ranks.findLastIndex(\n    (rank, index) => rank && index < firstUndefined\n  )\n\n  if (firstDefinedAfter === -1 || firstDefinedBefore === -1) {\n    throw new Error(\n      `Unable to generate middle value between indexes ${firstDefinedBefore} and ${firstDefinedAfter}`\n    )\n  }\n\n  const beforeRank = ranks[firstDefinedBefore]\n  const afterRank = ranks[firstDefinedAfter]\n\n  if (\n    !beforeRank ||\n    typeof beforeRank === 'undefined' ||\n    !afterRank ||\n    typeof afterRank === 'undefined'\n  ) {\n    throw new Error(\n      `Unable to generate middle value between indexes ${firstDefinedBefore} and ${firstDefinedAfter}`\n    )\n  }\n\n  // Generate a new value between the two\n  const between = beforeRank.between(afterRank)\n\n  // Calculate the middle index between the defined values\n  const middle = Math.floor((firstDefinedAfter + firstDefinedBefore) / 2)\n\n  if (ranks[middle]) {\n    throw new Error(`Should not have overwritten value at index ${middle}`)\n  }\n\n  // Insert the new value into the array\n  ranks[middle] = between\n\n  // Return as a new array\n  return ranks\n}\n\n// Generates an array of LexoRanks between two values\nexport function generateMultipleOrderRanks(\n  count: number,\n  start?: LexoRank,\n  end?: LexoRank\n): LexoRank[] {\n  // Begin array with correct size\n  let ranks = [...Array(count)]\n\n  // Use or create default values\n  const rankStart = start ?? LexoRank.min().genNext().genNext()\n  const rankEnd = end ?? LexoRank.max().genPrev().genPrev()\n\n  ranks[0] = rankStart\n  ranks[count - 1] = rankEnd\n\n  // Keep processing the array until every value between undefined values is defined\n  for (let i = 0; i < count; i++) {\n    ranks = generateMiddleValue(ranks)\n  }\n\n  return ranks.sort((a, b) => a.toString().localeCompare(b.toString()))\n}\n","import {PropsWithChildren} from 'react'\nimport styled, {css} from 'styled-components'\nimport {Card, Grid} from '@sanity/ui'\nimport {motion, AnimatePresence} from 'framer-motion'\n\nconst StyledFloatingCard = styled(Card)(\n  () => css`\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    z-index: 1000;\n  `\n)\n\nexport default function FloatingCard({children}: PropsWithChildren) {\n  const childrenHaveValues = Array.isArray(children) ? children.some(Boolean) : Boolean(children)\n\n  return (\n    <AnimatePresence>\n      {childrenHaveValues ? (\n        <motion.div key=\"floater\" initial={{opacity: 0}} animate={{opacity: 1}} exit={{opacity: 0}}>\n          <StyledFloatingCard shadow={3} padding={3} margin={3} radius={3}>\n            <Grid gap={2}>{children}</Grid>\n          </StyledFloatingCard>\n        </motion.div>\n      ) : null}\n    </AnimatePresence>\n  )\n}\n","import {Button, useToast} from '@sanity/ui'\nimport {LexoRank} from 'lexorank'\nimport React from 'react'\nimport {useClient} from 'sanity'\nimport {UserExtended} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport {generateMultipleOrderRanks} from '../helpers/generateMultipleOrderRanks'\nimport {SanityDocumentWithMetadata, State} from '../types'\nimport FloatingCard from './FloatingCard'\n\ntype VerifyProps = {\n  data: SanityDocumentWithMetadata[]\n  userList: UserExtended[]\n  states: State[]\n}\n\n// This component checks the validity of the data in the Kanban\n// It will only render something it there is invalid date\n// And will render buttons to fix the data\nexport default function Verify(props: VerifyProps) {\n  const {data, userList, states} = props\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n\n  // A lot of error-checking\n  const documentsWithoutValidMetadataIds = data?.length\n    ? data.reduce((acc, cur) => {\n        const {documentId, state} = cur._metadata ?? {}\n        const stateExists = states.find((s) => s.id === state)\n\n        return !stateExists && documentId ? [...acc, documentId] : acc\n      }, [] as string[])\n    : []\n\n  const documentsWithInvalidUserIds =\n    data?.length && userList?.length\n      ? data.reduce((acc, cur) => {\n          const {documentId, assignees} = cur._metadata ?? {}\n          const allAssigneesExist = assignees?.length\n            ? assignees?.every((a) => userList.find((u) => u.id === a))\n            : true\n\n          return !allAssigneesExist && documentId ? [...acc, documentId] : acc\n        }, [] as string[])\n      : []\n\n  const documentsWithoutOrderIds = data?.length\n    ? data.reduce((acc, cur) => {\n        const {documentId, orderRank} = cur._metadata ?? {}\n\n        return !orderRank && documentId ? [...acc, documentId] : acc\n      }, [] as string[])\n    : []\n\n  const documentsWithDuplicatedOrderIds = data?.length\n    ? data.reduce((acc, cur) => {\n        const {documentId, orderRank} = cur._metadata ?? {}\n\n        return orderRank &&\n          data.filter((d) => d._metadata?.orderRank === orderRank).length > 1 &&\n          documentId\n          ? [...acc, documentId]\n          : acc\n      }, [] as string[])\n    : []\n\n  // Updates metadata documents to a valid, existing state\n  const correctDocuments = React.useCallback(\n    async (ids: string[]) => {\n      toast.push({\n        title: 'Correcting...',\n        status: 'info',\n      })\n\n      const tx = ids.reduce((item, documentId) => {\n        return item.patch(`workflow-metadata.${documentId}`, {\n          set: {state: states[0].id},\n        })\n      }, client.transaction())\n\n      await tx.commit()\n\n      toast.push({\n        title: `Corrected ${\n          ids.length === 1 ? `1 Document` : `${ids.length} Documents`\n        }`,\n        status: 'success',\n      })\n    },\n    [client, states, toast]\n  )\n\n  // Remove users that are no longer in the project from documents\n  const removeUsersFromDocuments = React.useCallback(\n    async (ids: string[]) => {\n      toast.push({\n        title: 'Removing users...',\n        status: 'info',\n      })\n\n      const tx = ids.reduce((item, documentId) => {\n        const {assignees} =\n          data.find((d) => d._id === documentId)?._metadata ?? {}\n        const validAssignees = assignees?.length\n          ? // eslint-disable-next-line max-nested-callbacks\n            assignees.filter((a) => userList.find((u) => u.id === a)?.id)\n          : []\n\n        return item.patch(`workflow-metadata.${documentId}`, {\n          set: {assignees: validAssignees},\n        })\n      }, client.transaction())\n\n      await tx.commit()\n\n      toast.push({\n        title: `Corrected ${\n          ids.length === 1 ? `1 Document` : `${ids.length} Documents`\n        }`,\n        status: 'success',\n      })\n    },\n    [client, data, toast, userList]\n  )\n\n  // Add order value to metadata documents\n  const addOrderToDocuments = React.useCallback(\n    async (ids: string[]) => {\n      toast.push({\n        title: 'Adding ordering...',\n        status: 'info',\n      })\n\n      // Get first and second order values, if they exist\n      const [firstOrder, secondOrder] = [...data]\n        .slice(0, 2)\n        .map((d) => d._metadata?.orderRank)\n      const minLexo = firstOrder ? LexoRank.parse(firstOrder) : undefined\n      const maxLexo = secondOrder ? LexoRank.parse(secondOrder) : undefined\n      const ranks = generateMultipleOrderRanks(ids.length, minLexo, maxLexo)\n\n      const tx = client.transaction()\n\n      // Create a new in-between value for each document\n      for (let index = 0; index < ids.length; index += 1) {\n        tx.patch(`workflow-metadata.${ids[index]}`, {\n          set: {orderRank: ranks[index].toString()},\n        })\n      }\n\n      await tx.commit()\n\n      toast.push({\n        title: `Added order to ${\n          ids.length === 1 ? `1 Document` : `${ids.length} Documents`\n        }`,\n        status: 'success',\n      })\n    },\n    [data, client, toast]\n  )\n\n  // Reset order value on all metadata documents\n  const resetOrderOfAllDocuments = React.useCallback(\n    async (ids: string[]) => {\n      toast.push({\n        title: 'Adding ordering...',\n        status: 'info',\n      })\n\n      const ranks = generateMultipleOrderRanks(ids.length)\n\n      const tx = client.transaction()\n\n      // Create a new in-between value for each document\n      for (let index = 0; index < ids.length; index += 1) {\n        tx.patch(`workflow-metadata.${ids[index]}`, {\n          set: {orderRank: ranks[index].toString()},\n        })\n      }\n\n      await tx.commit()\n\n      toast.push({\n        title: `Added order to ${\n          ids.length === 1 ? `1 Document` : `${ids.length} Documents`\n        }`,\n        status: 'success',\n      })\n    },\n    [data, client, toast]\n  )\n\n  // A document could be deleted and the workflow metadata left behind\n  const orphanedMetadataDocumentIds = React.useMemo(() => {\n    return data.length\n      ? data.filter((doc) => !doc?._id).map((doc) => doc._metadata.documentId)\n      : []\n  }, [data])\n\n  const handleOrphans = React.useCallback(() => {\n    toast.push({\n      title: 'Removing orphaned metadata...',\n      status: 'info',\n    })\n\n    const tx = client.transaction()\n    orphanedMetadataDocumentIds.forEach((id) => {\n      tx.delete(`workflow-metadata.${id}`)\n    })\n\n    tx.commit()\n\n    toast.push({\n      title: `Removed ${orphanedMetadataDocumentIds.length} orphaned metadata documents`,\n      status: 'success',\n    })\n  }, [client, orphanedMetadataDocumentIds, toast])\n\n  return (\n    <FloatingCard>\n      {documentsWithoutValidMetadataIds.length > 0 ? (\n        <Button\n          tone=\"caution\"\n          mode=\"ghost\"\n          onClick={() => correctDocuments(documentsWithoutValidMetadataIds)}\n          text={\n            documentsWithoutValidMetadataIds.length === 1\n              ? `Correct 1 Document State`\n              : `Correct ${documentsWithoutValidMetadataIds.length} Document States`\n          }\n        />\n      ) : null}\n      {documentsWithInvalidUserIds.length > 0 ? (\n        <Button\n          tone=\"caution\"\n          mode=\"ghost\"\n          onClick={() => removeUsersFromDocuments(documentsWithInvalidUserIds)}\n          text={\n            documentsWithInvalidUserIds.length === 1\n              ? `Remove Invalid Users from 1 Document`\n              : `Remove Invalid Users from ${documentsWithInvalidUserIds.length} Documents`\n          }\n        />\n      ) : null}\n      {documentsWithoutOrderIds.length > 0 ? (\n        <Button\n          tone=\"caution\"\n          mode=\"ghost\"\n          onClick={() => addOrderToDocuments(documentsWithoutOrderIds)}\n          text={\n            documentsWithoutOrderIds.length === 1\n              ? `Set Order for 1 Document`\n              : `Set Order for ${documentsWithoutOrderIds.length} Documents`\n          }\n        />\n      ) : null}\n      {documentsWithDuplicatedOrderIds.length > 0 ? (\n        <>\n          <Button\n            tone=\"caution\"\n            mode=\"ghost\"\n            onClick={() => addOrderToDocuments(documentsWithDuplicatedOrderIds)}\n            text={\n              documentsWithDuplicatedOrderIds.length === 1\n                ? `Set Unique Order for 1 Document`\n                : `Set Unique Order for ${documentsWithDuplicatedOrderIds.length} Documents`\n            }\n          />\n          <Button\n            tone=\"caution\"\n            mode=\"ghost\"\n            onClick={() =>\n              resetOrderOfAllDocuments(\n                data.map((doc) => String(doc._metadata?.documentId))\n              )\n            }\n            text={\n              data.length === 1\n                ? `Reset Order for 1 Document`\n                : `Reset Order for all ${data.length} Documents`\n            }\n          />\n        </>\n      ) : null}\n      {orphanedMetadataDocumentIds.length > 0 ? (\n        <Button\n          text=\"Cleanup orphaned metadata\"\n          onClick={handleOrphans}\n          tone=\"caution\"\n          mode=\"ghost\"\n        />\n      ) : null}\n    </FloatingCard>\n  )\n}\n","import {\n  DragDropContext,\n  DraggableChildrenFn,\n  DragStart,\n  Droppable,\n  DropResult,\n} from '@hello-pangea/dnd'\nimport {\n  Box,\n  Card,\n  Container,\n  Flex,\n  Grid,\n  Spinner,\n  useTheme,\n  useToast,\n} from '@sanity/ui'\nimport {LexoRank} from 'lexorank'\nimport React from 'react'\nimport {Tool, useCurrentUser} from 'sanity'\nimport {Feedback, useProjectUsers} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport {arraysContainMatchingString} from '../helpers/arraysContainMatchingString'\nimport {filterItemsAndSort} from '../helpers/filterItemsAndSort'\nimport {useWorkflowDocuments} from '../hooks/useWorkflowDocuments'\nimport {State, WorkflowConfig} from '../types'\nimport {DocumentCard} from './DocumentCard'\nimport DocumentList from './DocumentList'\nimport Filters from './Filters'\nimport StateTitle from './StateTitle'\nimport Verify from './Verify'\n\ntype WorkflowToolProps = {\n  tool: Tool<WorkflowConfig>\n}\n\nexport default function WorkflowTool(props: WorkflowToolProps) {\n  const {\n    schemaTypes = [],\n    states = [],\n    filters = null,\n  } = props?.tool?.options ?? {}\n\n  const isDarkMode = useTheme().sanity.color.dark\n  const defaultCardTone = isDarkMode ? 'default' : 'transparent'\n  const toast = useToast()\n\n  const userList = useProjectUsers({apiVersion: API_VERSION})\n\n  const user = useCurrentUser()\n  const userRoleNames = user?.roles?.length\n    ? user?.roles.map((r) => r.name)\n    : []\n\n  const filtered = filters?.(user)\n\n  const {workflowData, operations} = useWorkflowDocuments(schemaTypes, filtered)\n  const [patchingIds, setPatchingIds] = React.useState<string[]>([])\n\n  // Data to display in cards\n  const {data, loading, error} = workflowData\n\n  // Operations to perform on cards\n  const {move} = operations\n\n  const [undroppableStates, setUndroppableStates] = React.useState<string[]>([])\n  const [draggingFrom, setDraggingFrom] = React.useState(``)\n\n  // When drag starts, check for any States we should not allow dropping on\n  // Because of either:\n  // 1. The \"destination\" State requires user assignment and the user is not assigned to the dragged document\n  // 2. The \"source\" State State has a list of transitions and the \"destination\" State is not in that list\n  const handleDragStart = React.useCallback(\n    (start: DragStart) => {\n      const {draggableId, source} = start\n      const {droppableId: currentStateId} = source\n      setDraggingFrom(currentStateId)\n\n      const document = data.find(\n        (item) => item._metadata?.documentId === draggableId\n      )\n      const state = states.find((s) => s.id === currentStateId)\n\n      // This shouldn't happen but TypeScript\n      if (!document || !state) return\n\n      const undroppableStateIds = []\n      const statesThatRequireAssignmentIds = states\n        .filter((s) => s.requireAssignment)\n        .map((s) => s.id)\n\n      if (statesThatRequireAssignmentIds.length) {\n        const documentAssignees = document._metadata?.assignees ?? []\n        const userIsAssignedToDocument = user?.id\n          ? documentAssignees.includes(user.id)\n          : false\n\n        if (!userIsAssignedToDocument) {\n          undroppableStateIds.push(...statesThatRequireAssignmentIds)\n        }\n      }\n\n      const statesThatCannotBeTransitionedToIds =\n        state.transitions && state.transitions.length\n          ? states\n              .filter((s) => !state.transitions?.includes(s.id))\n              .map((s) => s.id)\n          : []\n\n      if (statesThatCannotBeTransitionedToIds.length) {\n        undroppableStateIds.push(...statesThatCannotBeTransitionedToIds)\n      }\n\n      // Remove currentStateId from undroppableStates\n      const undroppableExceptSelf = undroppableStateIds.filter(\n        (id) => id !== currentStateId\n      )\n\n      if (undroppableExceptSelf.length) {\n        setUndroppableStates(undroppableExceptSelf)\n      }\n    },\n    [data, states, user]\n  )\n\n  const handleDragEnd = React.useCallback(\n    async (result: DropResult) => {\n      // Reset undroppable states\n      setUndroppableStates([])\n      setDraggingFrom(``)\n\n      const {draggableId, source, destination} = result\n\n      if (\n        // No destination?\n        !destination ||\n        // No change in position?\n        (destination.droppableId === source.droppableId &&\n          destination.index === source.index)\n      ) {\n        return\n      }\n\n      // Find all items in current state\n      const destinationStateItems = [\n        ...filterItemsAndSort(data, destination.droppableId, [], null),\n      ]\n      const destinationStateIndex = states.findIndex(\n        (s) => s.id === destination.droppableId\n      )\n      const globalStateMinimumRank = data[0]._metadata.orderRank\n      const globalStateMaximumRank = data[data.length - 1]._metadata.orderRank\n\n      let newOrder\n\n      if (!destinationStateItems.length) {\n        // Only item in state\n        // New minimum rank\n        if (destinationStateIndex === 0) {\n          // Only the first state should generate an absolute minimum rank\n          newOrder = LexoRank.min().toString()\n        } else {\n          // Otherwise create one rank above the minimum\n          newOrder = LexoRank.min().genNext().toString()\n        }\n      } else if (destination.index === 0) {\n        // Now first item in order\n        const firstItemOrderRank = [...destinationStateItems].shift()?._metadata\n          ?.orderRank\n\n        if (firstItemOrderRank && typeof firstItemOrderRank === 'string') {\n          newOrder = LexoRank.parse(firstItemOrderRank).genPrev().toString()\n        } else if (destinationStateIndex === 0) {\n          // Only the first state should generate an absolute minimum rank\n          newOrder = LexoRank.min().toString()\n        } else {\n          // Otherwise create the next rank between min and the globally minimum rank\n          newOrder = LexoRank.parse(globalStateMinimumRank)\n            .between(LexoRank.min())\n            .toString()\n        }\n      } else if (destination.index + 1 === destinationStateItems.length) {\n        // Now last item in order\n        const lastItemOrderRank = [...destinationStateItems].pop()?._metadata\n          ?.orderRank\n\n        if (lastItemOrderRank && typeof lastItemOrderRank === 'string') {\n          newOrder = LexoRank.parse(lastItemOrderRank).genNext().toString()\n        } else if (destinationStateIndex === states.length - 1) {\n          // Only the last state should generate an absolute maximum rank\n          newOrder = LexoRank.max().toString()\n        } else {\n          // Otherwise create the next rank between max and the globally maximum rank\n          newOrder = LexoRank.parse(globalStateMaximumRank)\n            .between(LexoRank.min())\n            .toString()\n        }\n      } else {\n        // Must be between two items\n        const itemBefore = destinationStateItems[destination.index - 1]\n        const itemBeforeRank = itemBefore?._metadata?.orderRank\n        let itemBeforeRankParsed\n        if (itemBeforeRank) {\n          itemBeforeRankParsed = LexoRank.parse(itemBeforeRank)\n        } else if (destinationStateIndex === 0) {\n          itemBeforeRankParsed = LexoRank.min()\n        } else {\n          itemBeforeRankParsed = LexoRank.parse(globalStateMinimumRank)\n        }\n\n        const itemAfter = destinationStateItems[destination.index]\n        const itemAfterRank = itemAfter?._metadata?.orderRank\n        let itemAfterRankParsed\n        if (itemAfterRank) {\n          itemAfterRankParsed = LexoRank.parse(itemAfterRank)\n        } else if (destinationStateIndex === states.length - 1) {\n          itemAfterRankParsed = LexoRank.max()\n        } else {\n          itemAfterRankParsed = LexoRank.parse(globalStateMaximumRank)\n        }\n\n        newOrder = itemBeforeRankParsed.between(itemAfterRankParsed).toString()\n      }\n\n      setPatchingIds([...patchingIds, draggableId])\n      toast.push({\n        status: 'info',\n        title: 'Updating document state...',\n      })\n      await move(draggableId, destination, states, newOrder)\n      setPatchingIds((ids: string[]) => ids.filter((id) => id !== draggableId))\n    },\n    [data, patchingIds, toast, move, states]\n  )\n\n  // Used for the user filter UI\n  const uniqueAssignedUsers = React.useMemo(() => {\n    const uniqueUserIds = data.reduce((acc, item) => {\n      const {assignees = []} = item._metadata ?? {}\n      const newAssignees = assignees?.length\n        ? assignees.filter((a) => !acc.includes(a))\n        : []\n      return newAssignees.length ? [...acc, ...newAssignees] : acc\n    }, [] as string[])\n\n    return userList.filter((u) => uniqueUserIds.includes(u.id))\n  }, [data, userList])\n\n  // Selected user IDs filter the visible workflow documents\n  const [selectedUserIds, setSelectedUserIds] = React.useState<string[]>(\n    uniqueAssignedUsers.map((u) => u.id)\n  )\n  const toggleSelectedUser = React.useCallback((userId: string) => {\n    setSelectedUserIds((prev) =>\n      prev.includes(userId)\n        ? prev.filter((u) => u !== userId)\n        : [...prev, userId]\n    )\n  }, [])\n  const resetSelectedUsers = React.useCallback(() => {\n    setSelectedUserIds([])\n  }, [])\n\n  // Selected schema types filter the visible workflow documents\n  const [selectedSchemaTypes, setSelectedSchemaTypes] =\n    React.useState<string[]>(schemaTypes)\n  const toggleSelectedSchemaType = React.useCallback((schemaType: string) => {\n    setSelectedSchemaTypes((prev) =>\n      prev.includes(schemaType)\n        ? prev.filter((u) => u !== schemaType)\n        : [...prev, schemaType]\n    )\n  }, [])\n\n  // Document IDs that have validation errors\n  const [invalidDocumentIds, setInvalidDocumentIds] = React.useState<string[]>(\n    []\n  )\n  const toggleInvalidDocumentId = React.useCallback(\n    (docId: string, action: 'ADD' | 'REMOVE') => {\n      setInvalidDocumentIds((prev) =>\n        action === 'ADD' ? [...prev, docId] : prev.filter((id) => id !== docId)\n      )\n    },\n    []\n  )\n\n  const Clone: DraggableChildrenFn = React.useCallback(\n    (provided, snapshot, rubric) => {\n      const item = data.find(\n        (doc) => doc?._metadata?.documentId === rubric.draggableId\n      )\n\n      return (\n        <div\n          {...provided.draggableProps}\n          {...provided.dragHandleProps}\n          ref={provided.innerRef}\n        >\n          {item ? (\n            <DocumentCard\n              // Assumed false, if it's dragging it's not disabled\n              isDragDisabled={false}\n              // Assumed false, if it's dragging it's not patching\n              isPatching={false}\n              // Assumed true, if you can drag it you can drop it\n              userRoleCanDrop\n              isDragging={snapshot.isDragging}\n              item={item}\n              states={states}\n              toggleInvalidDocumentId={toggleInvalidDocumentId}\n              userList={userList}\n            />\n          ) : (\n            <Feedback title=\"Item not found\" tone=\"caution\" />\n          )}\n        </div>\n      )\n    },\n    [data, states, toggleInvalidDocumentId, userList]\n  )\n\n  if (!states?.length) {\n    return (\n      <Container width={1} padding={5}>\n        <Feedback\n          tone=\"caution\"\n          title=\"Plugin options error\"\n          description=\"No States defined in plugin config\"\n        />\n      </Container>\n    )\n  }\n\n  if (error && !data.length) {\n    return (\n      <Container width={1} padding={5}>\n        <Feedback\n          tone=\"critical\"\n          title=\"Error querying for Workflow documents\"\n        />\n      </Container>\n    )\n  }\n\n  return (\n    <Flex direction=\"column\" height=\"fill\" overflow=\"hidden\">\n      <Verify data={data} userList={userList} states={states} />\n\n      <Filters\n        uniqueAssignedUsers={uniqueAssignedUsers}\n        selectedUserIds={selectedUserIds}\n        toggleSelectedUser={toggleSelectedUser}\n        resetSelectedUsers={resetSelectedUsers}\n        schemaTypes={schemaTypes}\n        selectedSchemaTypes={selectedSchemaTypes}\n        toggleSelectedSchemaType={toggleSelectedSchemaType}\n      />\n      <DragDropContext onDragStart={handleDragStart} onDragEnd={handleDragEnd}>\n        <Grid columns={states.length} height=\"fill\">\n          {states.map((state: State, stateIndex: number) => {\n            const userRoleCanDrop = state?.roles?.length\n              ? arraysContainMatchingString(state.roles, userRoleNames)\n              : true\n            const isDropDisabled =\n              !userRoleCanDrop || undroppableStates.includes(state.id)\n\n            return (\n              <Card\n                key={state.id}\n                borderLeft={stateIndex > 0}\n                tone={defaultCardTone}\n              >\n                <Flex direction=\"column\" height=\"fill\">\n                  <StateTitle\n                    state={state}\n                    requireAssignment={state.requireAssignment ?? false}\n                    userRoleCanDrop={userRoleCanDrop}\n                    isDropDisabled={isDropDisabled}\n                    draggingFrom={draggingFrom}\n                    documentCount={\n                      filterItemsAndSort(\n                        data,\n                        state.id,\n                        selectedUserIds,\n                        selectedSchemaTypes\n                      ).length\n                    }\n                  />\n                  <Box flex={1}>\n                    <Droppable\n                      droppableId={state.id}\n                      isDropDisabled={isDropDisabled}\n                      // props required for virtualization\n                      mode=\"virtual\"\n                      renderClone={Clone}\n                    >\n                      {(provided, snapshot) => (\n                        <Card\n                          ref={provided.innerRef}\n                          tone={\n                            snapshot.isDraggingOver\n                              ? `primary`\n                              : defaultCardTone\n                          }\n                          height=\"fill\"\n                        >\n                          {loading ? (\n                            <Flex padding={5} align=\"center\" justify=\"center\">\n                              <Spinner muted />\n                            </Flex>\n                          ) : null}\n\n                          <DocumentList\n                            data={data}\n                            invalidDocumentIds={invalidDocumentIds}\n                            patchingIds={patchingIds}\n                            selectedSchemaTypes={selectedSchemaTypes}\n                            selectedUserIds={selectedUserIds}\n                            state={state}\n                            states={states}\n                            toggleInvalidDocumentId={toggleInvalidDocumentId}\n                            user={user}\n                            userList={userList}\n                            userRoleCanDrop={userRoleCanDrop}\n                          />\n\n                          {/* Not required for virtualized lists */}\n                          {/* {provided.placeholder} */}\n                        </Card>\n                      )}\n                    </Droppable>\n                  </Box>\n                </Flex>\n              </Card>\n            )\n          })}\n        </Grid>\n      </DragDropContext>\n    </Flex>\n  )\n}\n","import {SplitVerticalIcon} from '@sanity/icons'\nimport {Tool} from 'sanity'\n\nimport WorkflowTool from '../components/WorkflowTool'\nimport {WorkflowConfig} from '../types'\n\nexport type WorkflowToolConfig = (options: WorkflowConfig) => Tool\n\nexport const workflowTool: WorkflowToolConfig = (options: WorkflowConfig) => ({\n  name: 'workflow',\n  title: 'Workflow',\n  component: WorkflowTool,\n  icon: SplitVerticalIcon,\n  options,\n})\n","import {definePlugin, DocumentActionProps, isObjectInputProps} from 'sanity'\n\nimport {AssignWorkflow} from './actions/AssignWorkflow'\nimport {BeginWorkflow} from './actions/BeginWorkflow'\nimport {CompleteWorkflow} from './actions/CompleteWorkflow'\nimport {UpdateWorkflow} from './actions/UpdateWorkflow'\nimport {AssigneesBadge} from './badges/AssigneesBadge'\nimport {StateBadge} from './badges/StateBadge'\nimport {WorkflowProvider} from './components/WorkflowContext'\nimport WorkflowSignal from './components/WorkflowSignal'\nimport {DEFAULT_CONFIG} from './constants'\nimport metadata from './schema/workflow/workflow.metadata'\nimport {workflowTool} from './tools'\nimport {WorkflowConfig} from './types'\n\nexport const workflow = definePlugin<WorkflowConfig>(\n  (config = DEFAULT_CONFIG) => {\n    const {schemaTypes, states, filters} = {...DEFAULT_CONFIG, ...config}\n\n    if (!states?.length) {\n      throw new Error(`Workflow plugin: Missing \"states\" in config`)\n    }\n\n    if (!schemaTypes?.length) {\n      throw new Error(`Workflow plugin: Missing \"schemaTypes\" in config`)\n    }\n\n    return {\n      name: 'sanity-plugin-workflow',\n      schema: {\n        types: [metadata(states)],\n      },\n      // TODO: Remove 'workflow.metadata' from list of new document types\n      // ...\n      studio: {\n        components: {\n          layout: (props) =>\n            WorkflowProvider({\n              ...props,\n              workflow: {schemaTypes, states, filters},\n            }),\n        },\n      },\n      form: {\n        components: {\n          input: (props) => {\n            if (\n              props.id === `root` &&\n              isObjectInputProps(props) &&\n              schemaTypes.includes(props.schemaType.name)\n            ) {\n              return WorkflowSignal(props)\n            }\n\n            return props.renderDefault(props)\n          },\n        },\n      },\n      document: {\n        actions: (prev, context) => {\n          if (!schemaTypes.includes(context.schemaType)) {\n            return prev\n          }\n\n          return [\n            (props) => BeginWorkflow(props),\n            (props) => AssignWorkflow(props),\n            ...states.map(\n              (state) => (props: DocumentActionProps) =>\n                UpdateWorkflow(props, state)\n            ),\n            (props) => CompleteWorkflow(props),\n            ...prev,\n          ]\n        },\n        badges: (prev, context) => {\n          if (!schemaTypes.includes(context.schemaType)) {\n            return prev\n          }\n\n          const {documentId, currentUser} = context\n\n          if (!documentId) {\n            return prev\n          }\n\n          return [\n            () => StateBadge(documentId),\n            () => AssigneesBadge(documentId, currentUser),\n            ...prev,\n          ]\n        },\n      },\n      tools: [\n        // TODO: These configs could be read from Context\n        workflowTool({schemaTypes, states, filters}),\n      ],\n    }\n  }\n)\n"],"names":["defineStates","states","API_VERSION","DEFAULT_CONFIG","schemaTypes","id","title","color","roles","transitions","requireAssignment","filters","UserAssignment","props","assignees","userList","documentId","client","useClient","apiVersion","toast","useToast","addAssignee","React","useCallback","userId","user","find","u","push","status","patch","concat","setIfMissing","insert","commit","then","displayName","catch","err","console","error","description","removeAssignee","unset","clearAssignees","jsx","UserSelectMenu","style","maxHeight","value","onAdd","onClear","onRemove","useWorkflowMetadata","ids","data","rawData","loading","useListeningQuery","params","options","keyedMetadata","useMemo","length","reduce","acc","cur","WorkflowContext","createContext","addId","removeId","useWorkflowContext","current","useContext","metadata","WorkflowProvider","setIds","useState","includes","filter","i","Provider","workflow","children","renderDefault","AssignWorkflow","_a","isDialogOpen","setDialogOpen","useProjectUsers","icon","UsersIcon","type","disabled","label","dialog","onClose","content","onHandle","BeginWorkflow","draft","beginning","setBeginning","complete","setComplete","handle","lowestOrderFirstState","fetch","state","createIfNotExists","_id","_type","orderRank","LexoRank","parse","genNext","toString","min","locale","SplitVerticalIcon","CompleteWorkflow","delete","s","isLastState","CheckmarkIcon","arraysContainMatchingString","one","two","some","item","UpdateWorkflow","actionState","_b","_c","_d","useCurrentUser","currentUser","currentState","validation","isValidating","useValidationStatus","hasValidationErrors","requireValidation","v","level","newState","set","onComplete","currentStateIndex","findIndex","actionStateIndex","direction","DirectionIcon","ArrowRightIcon","ArrowLeftIcon","directionLabel","userRoleCanUpdateState","map","r","name","actionStateIsAValidTransition","userAssignmentCanUpdateState","AssigneesBadge","hasMe","assignee","assigneesCount","assigneeUsers","join","StateBadge","WorkflowSignal","replace","useEffect","EditButton","navigateIntent","useRouter","Button","onClick","mode","fontSize","padding","tabIndex","EditIcon","text","Field","schema","useSchema","String","draftId","Spinner","schemaType","get","Feedback","tone","Card","border","jsxs","Flex","align","justify","gap","Preview","layout","UserAssignmentInput","useFormValue","stringValue","Array","isArray","initialRank","lastRankValue","lastRank","nextRank","defineType","liveEdit","fields","defineField","readOnly","list","components","input","initialValue","p","_ref","getClient","lastDocOrderRank","order","of","filterItemsAndSort","items","stateId","selectedUsers","arguments","undefined","selectedSchemaTypes","_metadata","sort","a","b","aOrderRank","bOrderRank","localeCompare","useWorkflowDocuments","filtered","localeFilter","QUERY","groq","__template","localDocuments","setLocalDocuments","move","draggedId","destination","newOrder","currentLocalData","newLocalDocuments","droppableId","optimistic","newStateId","document","d","_rev","ifRevisionId","res","message","workflowData","operations","AvatarGroup","users","max","len","me","visibleUsers","slice","UserAvatar","Box","marginRight","paddingLeft","Text","size","UserDisplay","button","popover","setPopover","isOpen","setIsOpen","close","open","useClickOutside","Popover","ref","portal","AddIcon","Grid","CompleteButton","handleComplete","event","currentTarget","Tooltip","TimeAgo","_ref2","time","timeAgo","useTimeAgo","DraftStatus","updatedAt","_updatedAt","Fragment","TextWithTone","dimmed","muted","PublishedStatus","PublishIcon","Validate","onChange","ValidationStatus","hasError","ErrorOutlineIcon","WarningOutlineIcon","DocumentCard","isDragDisabled","isPatching","userRoleCanDrop","isDragging","toggleInvalidDocumentId","isDarkMode","useTheme","sanity","dark","defaultCardTone","optimisticValidation","setOptimisticValidation","handleValidation","updates","cardTone","paddingBottom","paddingX","radius","shadow","Stack","borderBottom","paddingRight","pointerEvents","flex","skipVisibilityCheck","flexShrink","DragHandleIcon","paddingTop","getStyle","draggableStyle","virtualItem","transform","start","draggableTransformY","parseInt","split","position","top","left","width","height","DocumentList","invalidDocumentIds","patchingIds","selectedUserIds","dataFiltered","parentRef","useRef","virtualizer","useVirtualizer","count","getScrollElement","getItemKey","index","estimateSize","overscan","measureElement","element","getBoundingClientRect","overflow","overflowAnchor","scrollBehavior","getTotalSize","getVirtualItems","isInvalid","meInAssignees","Draggable","draggableId","draggableProvided","draggableSnapshot","innerRef","draggableProps","dragHandleProps","key","Filters","uniqueAssignedUsers","toggleSelectedUser","resetSelectedUsers","toggleSelectedSchemaType","meInUniqueAssignees","uniqueAssigneesNotMe","overflowX","MenuButton","UserIcon","menu","Menu","labels","addMe","removeMe","clear","withTooltip","borderRight","ResetIcon","typeName","Status","Icon","StyledStickyCard","styled","css","StateTitle","isDropDisabled","draggingFrom","documentCount","isSource","paddingY","Badge","InfoOutlineIcon","weight","generateMiddleValue","ranks","rank","firstUndefined","firstDefinedAfter","firstDefinedBefore","findLastIndex","Error","beforeRank","afterRank","between","middle","Math","floor","generateMultipleOrderRanks","end","rankStart","rankEnd","genPrev","StyledFloatingCard","FloatingCard","_ref3","childrenHaveValues","Boolean","AnimatePresence","motion","div","initial","opacity","animate","exit","margin","Verify","documentsWithoutValidMetadataIds","stateExists","documentsWithInvalidUserIds","allAssigneesExist","every","documentsWithoutOrderIds","documentsWithDuplicatedOrderIds","correctDocuments","tx","transaction","removeUsersFromDocuments","validAssignees","addOrderToDocuments","firstOrder","secondOrder","minLexo","maxLexo","resetOrderOfAllDocuments","orphanedMetadataDocumentIds","doc","handleOrphans","forEach","WorkflowTool","tool","userRoleNames","setPatchingIds","undroppableStates","setUndroppableStates","setDraggingFrom","handleDragStart","source","currentStateId","undroppableStateIds","statesThatRequireAssignmentIds","documentAssignees","userIsAssignedToDocument","statesThatCannotBeTransitionedToIds","undroppableExceptSelf","handleDragEnd","result","_e","_f","destinationStateItems","destinationStateIndex","globalStateMinimumRank","globalStateMaximumRank","firstItemOrderRank","shift","lastItemOrderRank","pop","itemBefore","itemBeforeRank","itemBeforeRankParsed","itemAfter","itemAfterRank","itemAfterRankParsed","uniqueUserIds","newAssignees","setSelectedUserIds","prev","setSelectedSchemaTypes","setInvalidDocumentIds","docId","action","Clone","provided","snapshot","rubric","Container","DragDropContext","onDragStart","onDragEnd","columns","stateIndex","borderLeft","Droppable","renderClone","isDraggingOver","workflowTool","component","definePlugin","config","types","studio","form","isObjectInputProps","actions","context","badges","tools"],"mappings":"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"}